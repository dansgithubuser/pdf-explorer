<script>

const API_HOST = 'http://localhost:8000/';

var gPdf;
var gObject;

function e(id) { return document.getElementById(id); }
function v(id) { return e(id).value; }

function api(op, path, params) {
  return fetch(API_HOST + op + '/' + path, {
    method: 'POST',
    body: JSON.stringify(params),
  }).then(r => r.json());
}

function apiPdf(attr, options) {
  options = {
    args: options.args || [],
    kwargs: options.kwargs || {},
    op: options.op || 'eval',
  };
  return api(options.op, `${gPdf}.${attr}`, [options.args, options.kwargs]);
}

function render() {
  var v = '';
  v += '<pre>';
  if (typeof gObject === 'object') {
    v += '<<\n';
    for (const i in gObject) v += `\t${i} ${gObject[i]}\n`;
    v += '>>';
  }
  v += '</pre>';
  e('view').innerHTML = v;
}

async function load() {
  gPdf = await api('store', 'Pdf');
  await apiPdf('load', { args: [v('file')] });
  gObject = await apiPdf('root', { op: 'get' });
  render();
}

window.onload = () => {
  e('file').addEventListener('keyup', function(event) {
    if (event.keyCode === 13) load();
  });
  e('load').addEventListener('click', load);
};

</script>

file: <input type='text' id='file' size=40> <input type='button' id='load' value='load'><br>
<br>
<div id='view'></div>
